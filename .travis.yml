language: node_js
node_js:
  - "10.8.0"

branches:
  only:
  - master

cache:
  directories:
    - node_modules

notifications:
  email: false

env:
  global:
    # HEROKU_API_TOKEN
    - secure: "iiTXk0Z3YNfxda0zNS5ON2hFzrTt+ulaMe0nlucotfYUzUqhZHBktnLwhCdsQb9vOWkXEZn47wxP+n2BaNW+4/4aYUlOSp363j73my0J3TzefLrr4RC2tulEJ/xjCmT/G2mrltFlwveUuCT4AM+7rqVPzQWp+OqS6ZhskXOj4sz0s2rzzJX5kj/tU6fgPD3xwRVUSWhF76VXqhwnJK0vqfCa/IScxVbEzIBf0YtzoYfFEqHRkRc0u2ZHsqb1ZDdrUE62IRd8N9m7n6eCLpmqmMgOhlvRHaBUe5QmywMgoLuysJNECCoQfIKg1HmT2WIqTgajgdwHqhg182gMpL6cew7RqD7+WpLExlwvqY/2bBJnhsoEVAcBMoSKYeD1tAdgLmeEAIEj8eDJVu6HBDe6DAFi+wgFWVRvstk3WbvNqGP0rat4P3od+gaja8QBNpvdig525p0ekEfN7fjB7h20tpwyKGjgZr8IxaPE+bJc7v7fLq+rdCjAfkaJkzCwN44JMK7l42mgpuJ129eJLIKUrdfr2/lPn7muMMCBjHKMVlO2veJetEUhwSciWmvW3GSoGpMr9xhR7yUoDcYFgJMnHfZdBGXO5/D/JBKbb2QTsiC+lggz5nunFY1m5xXaavy0EB8fD6BMEsomnKVaKeaQjHARRBhXs99Jb8tQ2nyxy9E="
    # MONGODB_DATABASE
    - secure: "zw5TjO49i5O3zHACNl5nPrhxL2ahifI42EOv195fr3jJ7g6q52iH/CCdifWfP1dYLYPBbKKoYMGHMaOjoUL6L8yWFVZuobmGNgmcx8JCZkHhnavOimM6sodD94lwbxfBfkKr+NFWCIb3F4JfKT5D4WTo1LhlH2X0XOz+hOBzd/CkYTVmGiS0reTrlaK2cDR34F8EZbtov1iEfR1yVb5r5FwkjFw/3uFy9+f6LtzBPJordQo5F6TxTSdjB5/8bymXnjyClmL8YeYbgbaoC2C2Ntu4bH46IAcWjjO+99T+HGmyAHLNYexm3Sxoyeo6EWJnAmOZUq/HinEPXgtTAHknNk2twWJT8phxaNtLhPT+A1iziHii9vN4SYWH+FSkuRR8MA+izhRp+2Rsg531TWQ8SPG2eODrT/3ch2XOjFPPOWjhN8cKkm5cF3uMze6ZAldfV0J/XHbQuBFKPb98PuQ6sF1QUb4HEKfhvTVQvbL1uhtjFbRARetrf5X0ZZogbTAZHAW19D1NM9uKCY7NQaQU/dXkIILnEJ2FUq3XeuzfdHpUzEFd+fFQFPhqP904cMlS3r61hBf5rldJ7pEzWV4XGQjga6eZnTiUPtwkGSkeixaEjqdtg+bGey80Nv1fl55O+GzY1+8T/2yQyhT2aJwgmnqhooZwDvGJsmKDf/xKlk8="

before_install:
  - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.9.4
  - export PATH="$HOME/.yarn/bin:$HOME/.config/yarn/global/node_modules/.bin:$PATH"
  - printf 'yarn-offline-mirror "./.yarn-offline-mirror"\n--production false\n--pure-lockfile true' >> .yarnrc

install:
  - yarn install

script:
  - yarn run test

before_deploy:
  - node infrastructure/config.js

deploy:
  provider: heroku
  api_key:
    secure: S2e2ne9ze1DKQIRqG5xFnKeSps7uRY0QAo7mlG21M6plRnmZuj3GWnvCVSb0xk2VrVLanMqhiRRXYedxw767KqFX5/dW3z+LQo0omLXDMFPaTKkUjqJJtCGgf0sNFLA4iKcsJ58XATfwpJAu4y2c6xF3Jct9rldYSRE/dAZDp/zxUoLEAZnHiye2jEAwAzooYvcavdDnmUhlErnBluFlbNsqpPWTNgLPc/CI7ZXSy0txfDRqwX1R3MeICaC9RuuMtKPm/WXZhNwjPwnB8m3dWNV7c/P9HlUq/nRbe6/hGuCTM3S1misp61mbpiJ5UwePqEmecDU/ZQ6+d8KrXaMjlFWthgrIC2277D7tX09Dfwlj/94KxjFOIgv+yJf7To5fe2NTpxC675tKvXmQW4w/+IDn7qYVl9PMXWNmgG4ZzmKlZVAEmAL+uTW+GwE5GmRRsQ69tpUBXqZd6LoroZEL0K5dYTu9XXmo0lLuT72GCQ5s6ftoaWNl6KF4pmxxULzGw0Gn/Y/TqZhHP7gVxmNHufJ/RpzHg9KVPaUzs4eqwXc7dvlilF7+4oBAdUnvwEPivn2mO+FpEGnmTyghWLX+WKzY/ipaHR7Sq+UwJYDg7LqZpJ3IQxNDgHv0tCeE5rF/uOcY0gV66zvgfBqm0A+eCyw7BFQbf83lGkH5hzguJ/w=
  skip-cleanup: true
  on:
    branch: master
  app: ps-family-tree-bff
